Below, I’ll flesh out the idea for your Expo app that enables social media mutuals to connect around various events—whether in real life (IRL) or online—using Appwrite as the backend. The app will allow users to suggest activities like meetups, hikes, or movie outings, include a voting mechanism for these suggestions, enable posting links to attract mutuals, and facilitate building secondary friendship graphs based on past activities. Since you’ve locked in Appwrite and Expo as the tech stack, I’ll focus on the features, database models, relationships, and rules for an agent to build this app, leveraging Appwrite’s capabilities.

---

### Core Features of the App

To meet your requirements, the app needs the following key features:

1. **User Management**  
   - Users can sign up, log in, and manage profiles with public information like username, bio, and interests.
   - Authentication will be secure, and profiles will support social connections.

2. **Event Suggestion and Voting**  
   - Users can propose events (e.g., hikes, movie nights) with details like title, description, and proposed date.
   - Other users can vote on these suggestions to show interest or approval.
   - A mechanism to finalize suggestions into confirmed events based on votes.

3. **Event Management**  
   - Confirmed events will have details like date, location (for IRL) or link (for online), and a list of attendees.
   - Users can join events and see who else is attending.

4. **Link Posting**  
   - Users can share links (e.g., articles, videos) to attract mutuals, visible to friends or based on shared interests/activities.
   - Visibility isn’t limited to followers but can extend to secondary connections.

5. **Secondary Friendship Graphs**  
   - The app will suggest or build connections between users based on shared past activities (e.g., attending the same events).
   - These connections go beyond direct followers, leveraging event participation.

6. **Real-Time Updates**  
   - Users receive live notifications for new suggestions, votes, or event updates to enhance engagement.

---

### Database Models and Relationships in Appwrite

Appwrite’s database will store the app’s data in collections. Below are the collections, their attributes, and relationships, designed to support the features using Appwrite’s capabilities (e.g., relationships, permissions, and real-time).

#### 1. UserProfiles Collection
- **Purpose**: Stores public user data (authentication is handled by Appwrite’s Users service).
- **Attributes**:
  - `user_id` (string, required, unique): Matches the Appwrite Users service ID.
  - `username` (string, required): Display name.
  - `profile_picture` (string): URL to an image (stored in Appwrite Storage).
  - `bio` (text): Short user description.
  - `interests` (array of strings): User’s hobbies or preferences (e.g., ["hiking", "movies"]).
  - `friends` (array of strings): User IDs of direct friends.
- **Notes**: 
  - Appwrite’s Users service handles email/password authentication, so this collection is for public data only.
  - The `friends` array simplifies querying direct connections.

#### 2. Suggestions Collection
- **Purpose**: Stores event suggestions proposed by users.
- **Attributes**:
  - `suggestion_id` (string, auto-generated by Appwrite): Unique identifier.
  - `title` (string, required): Event name (e.g., "Group Hike at Mount Trail").
  - `description` (text): Details about the suggestion.
  - `proposed_date` (datetime): Suggested date/time.
  - `proposer_id` (string): References `UserProfiles.user_id`.
  - `status` (string): "open", "closed", or "accepted".
- **Relationships**:
  - One-to-many: One user (`proposer_id`) can create multiple suggestions.

#### 3. Votes Collection
- **Purpose**: Tracks votes on event suggestions.
- **Attributes**:
  - `vote_id` (string, auto-generated): Unique identifier.
  - `suggestion_id` (string): References `Suggestions.suggestion_id`.
  - `user_id` (string): References `UserProfiles.user_id`.
  - `vote` (string): "yes" or "no" (or boolean if simpler).
  - `timestamp` (datetime): When the vote was cast.
- **Relationships**:
  - Many-to-one: Multiple votes link to one suggestion.
  - Many-to-one: Multiple votes can come from one user (across different suggestions).
- **Indexes**:
  - Unique index on `[suggestion_id, user_id]` to prevent duplicate votes.

#### 4. Events Collection
- **Purpose**: Stores confirmed events created from suggestions or directly.
- **Attributes**:
  - `event_id` (string, auto-generated): Unique identifier.
  - `title` (string, required): Event name.
  - `description` (text): Event details.
  - `date` (datetime): Scheduled date/time.
  - `location` (string): IRL location or online link (e.g., Zoom URL).
  - `organizer_id` (string): References `UserProfiles.user_id`.
  - `suggestion_id` (string, optional): References `Suggestions.suggestion_id` if derived from a suggestion.
- **Relationships**:
  - One-to-many: One user (`organizer_id`) can organize multiple events.
  - One-to-one (optional): An event may link to a suggestion.

#### 5. EventAttendees Collection
- **Purpose**: Manages event attendance (many-to-many relationship between Events and Users).
- **Attributes**:
  - `attendee_id` (string, auto-generated): Unique identifier.
  - `event_id` (string): References `Events.event_id`.
  - `user_id` (string): References `UserProfiles.user_id`.
- **Relationships**:
  - Many-to-many: Multiple users can attend multiple events.
- **Notes**: Enables querying attendees per event or events per user.

#### 6. Links Collection
- **Purpose**: Stores links posted by users to attract mutuals.
- **Attributes**:
  - `link_id` (string, auto-generated): Unique identifier.
  - `url` (string, required): The link (e.g., "https://example.com").
  - `title` (string): Link title.
  - `description` (text): Brief summary.
  - `poster_id` (string): References `UserProfiles.user_id`.
  - `tags` (array of strings): Categories (e.g., ["hiking", "news"]).
- **Relationships**:
  - One-to-many: One user (`poster_id`) can post multiple links.

#### Friendship Graphs
- **Direct Friends**: Stored in `UserProfiles.friends` array for simplicity.
- **Secondary Graphs**: Built dynamically by analyzing `EventAttendees`. Users who attend the same events frequently can be suggested as connections (no separate collection for MVP).

---

### Feature Implementation Details

#### 1. User Management
- **Sign Up/Login**: Use Appwrite’s Users service for authentication (email/password or OAuth).
- **Profiles**: On sign-up, create a `UserProfiles` document linked to the user’s Appwrite ID. Users can edit their profile via the app.

#### 2. Event Suggestion and Voting
- **Suggesting**: Users create a document in `Suggestions` with event details.
- **Voting**: Users add a `Votes` document for a suggestion. The app counts votes (e.g., query `Votes` where `suggestion_id = X` and `vote = "yes"`).
- **Finalizing**: When a suggestion gets enough votes (e.g., threshold of 5), the app creates an `Events` document and updates `Suggestions.status` to "accepted". This can be manual or automated via an Appwrite function.

#### 3. Event Management
- **Creating Events**: Derived from suggestions or directly by users.
- **Joining Events**: Users add an `EventAttendees` document to RSVP.
- **Details**: For IRL events, include `location` as a string (e.g., "Central Park"). For online events, `location` can be a URL.

#### 4. Link Posting
- **Posting**: Users create a `Links` document.
- **Visibility**: Links are visible to users in the poster’s `friends` array. For secondary connections, the app queries friends of friends or users with shared event attendance (client-side logic for MVP).

#### 5. Secondary Friendship Graphs
- **Tracking**: Query `EventAttendees` to find users who attended the same events (e.g., "User A and User B attended Event X and Y").
- **Suggestions**: Suggest adding these users to `UserProfiles.friends` if not already connected. For the MVP, this can be a manual suggestion; later, use Appwrite Functions to automate.

#### 6. Real-Time Updates
- Use Appwrite’s Realtime service to subscribe to changes in `Suggestions`, `Votes`, `Events`, and `Links`. Update the UI instantly when new data is added.

---

### Permissions in Appwrite

- **UserProfiles**:
  - Read: Anyone (public profiles).
  - Write: Only the user with matching `user_id`.
- **Suggestions**:
  - Read: Anyone.
  - Write: Creator (`proposer_id`) for updates; anyone can create.
- **Votes**:
  - Read: Anyone or restricted to `proposer_id` (configurable).
  - Write: Anyone can create; only voter can update/delete.
- **Events**:
  - Read: Anyone.
  - Write: Organizer (`organizer_id`).
- **EventAttendees**:
  - Read: Anyone.
  - Write: Anyone can join; only attendee can remove themselves.
- **Links**:
  - Read: Anyone (MVP) or restricted to friends via client-side filtering.
  - Write: Poster (`poster_id`).

---

### Rules for the Agent Building the App

1. **Tech Stack Usage**:
   - Use Expo (React Native) for the front end and Appwrite SDK for backend interactions.
   - Leverage Appwrite services: Authentication, Databases, Realtime, Functions, Storage.

2. **Security**:
   - Implement secure authentication with Appwrite’s Users service.
   - Set collection/document permissions to enforce access control server-side.
   - Validate all inputs client-side and server-side (via Functions if needed).

3. **UI Design**:
   - Create screens for:
     - Registration/login
     - Profile viewing/editing
     - Suggesting events
     - Viewing/voting on suggestions
     - Viewing/joining events
     - Posting/viewing links
     - Friends list and connection suggestions
   - Ensure a clean, intuitive interface.

4. **Real-Time**:
   - Subscribe to relevant collections (`Suggestions`, `Votes`, `Events`, `Links`) using Appwrite Realtime for live updates.

5. **Error Handling**:
   - Gracefully handle network errors, duplicate votes, or permission issues.
   - Provide user-friendly error messages.

6. **Testing**:
   - Test authentication flows, data creation, voting logic, and real-time updates.
   - Ensure scalability with mock users and events.

7. **Future Enhancements**:
   - Add geolocation for IRL events (Appwrite supports geospatial queries).
   - Integrate push notifications via Appwrite Functions.
   - Automate friendship graph updates with Functions analyzing `EventAttendees`.

---


