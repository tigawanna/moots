[
  {
    "id": "watchlists_collection",
    "name": "watchlists",
    "type": "base",
    "listRule": "@request.auth.id != '' && (isPublic = true || owner = @request.auth.id || @collection.watchlistShares.user ?= @request.auth.id)",
    "viewRule": "@request.auth.id != '' && (isPublic = true || owner = @request.auth.id || @collection.watchlistShares.user ?= @request.auth.id)",
    "createRule": "@request.auth.id != '' && @request.body.owner = @request.auth.id",
    "updateRule": "@request.auth.id != '' && (owner = @request.auth.id || (@collection.watchlistShares.user ?= @request.auth.id && @collection.watchlistShares.canEdit = true))",
    "deleteRule": "@request.auth.id != '' && owner = @request.auth.id",
    "fields": [
      {
        "id": "text_id",
        "name": "id",
        "type": "text",
        "required": true,
        "primaryKey": true,
        "autogeneratePattern": "[a-z0-9]{15}"
      },
      {
        "id": "text_title",
        "name": "title",
        "type": "text",
        "required": true,
        "max": 200,
        "min": 1
      },
      {
        "id": "editor_description",
        "name": "description",
        "type": "editor",
        "required": false
      },
      {
        "id": "relation_owner",
        "name": "owner",
        "type": "relation",
        "required": true,
        "options": {
          "collectionId": "_pb_users_auth_",
          "cascadeDelete": true,
          "minSelect": 1,
          "maxSelect": 1,
          "displayFields": ["name", "email"]
        }
      },
      {
        "id": "bool_isPublic",
        "name": "isPublic",
        "type": "bool",
        "required": false
      },
      {
        "id": "select_category",
        "name": "category",
        "type": "select",
        "required": false,
        "options": {
          "maxSelect": 1,
          "values": [
            "movies",
            "tv_shows",
            "mixed",
            "documentaries",
            "anime",
            "comedy",
            "drama",
            "action",
            "horror",
            "sci_fi",
            "romance",
            "thriller",
            "other"
          ]
        }
      },
      {
        "id": "file_coverImage",
        "name": "coverImage",
        "type": "file",
        "required": false,
        "options": {
          "maxSelect": 1,
          "maxSize": 5242880,
          "mimeTypes": ["image/jpeg", "image/png", "image/webp"],
          "thumbs": ["100x100", "300x300", "500x500"]
        }
      },
      {
        "id": "json_tags",
        "name": "tags",
        "type": "json",
        "required": false
      },
      {
        "id": "autodate_created",
        "name": "created",
        "type": "autodate",
        "onCreate": true,
        "onUpdate": false
      },
      {
        "id": "autodate_updated",
        "name": "updated",
        "type": "autodate",
        "onCreate": true,
        "onUpdate": true
      }
    ],
    "indexes": [
      "CREATE INDEX idx_watchlists_owner ON watchlists (owner)",
      "CREATE INDEX idx_watchlists_public ON watchlists (isPublic)",
      "CREATE INDEX idx_watchlists_category ON watchlists (category)",
      "CREATE INDEX idx_watchlists_created ON watchlists (created)"
    ]
  },
  {
    "id": "watchlist_items_collection",
    "name": "watchlistItems",
    "type": "base",
    "listRule": "@request.auth.id != '' && @collection.watchlists.id ?= watchlist && (@collection.watchlists.isPublic = true || @collection.watchlists.owner ?= @request.auth.id || @collection.watchlistShares.user ?= @request.auth.id)",
    "viewRule": "@request.auth.id != '' && @collection.watchlists.id ?= watchlist && (@collection.watchlists.isPublic = true || @collection.watchlists.owner ?= @request.auth.id || @collection.watchlistShares.user ?= @request.auth.id)",
    "createRule": "@request.auth.id != '' && (@collection.watchlists.owner ?= @request.auth.id || (@collection.watchlistShares.user ?= @request.auth.id && @collection.watchlistShares.canEdit = true))",
    "updateRule": "@request.auth.id != '' && (@collection.watchlists.owner ?= @request.auth.id || (@collection.watchlistShares.user ?= @request.auth.id && @collection.watchlistShares.canEdit = true))",
    "deleteRule": "@request.auth.id != '' && (@collection.watchlists.owner ?= @request.auth.id || (@collection.watchlistShares.user ?= @request.auth.id && @collection.watchlistShares.canEdit = true))",
    "fields": [
      {
        "id": "text_id",
        "name": "id",
        "type": "text",
        "required": true,
        "primaryKey": true,
        "autogeneratePattern": "[a-z0-9]{15}"
      },
      {
        "id": "relation_watchlist",
        "name": "watchlist",
        "type": "relation",
        "required": true,
        "options": {
          "collectionId": "watchlists_collection",
          "cascadeDelete": true,
          "minSelect": 1,
          "maxSelect": 1,
          "displayFields": ["title"]
        }
      },
      {
        "id": "select_mediaType",
        "name": "mediaType",
        "type": "select",
        "required": true,
        "options": {
          "maxSelect": 1,
          "values": ["movie", "tv_show"]
        }
      },
      {
        "id": "number_traktId",
        "name": "traktId",
        "type": "number",
        "required": true
      },
      {
        "id": "number_tmdbId",
        "name": "tmdbId",
        "type": "number",
        "required": false
      },
      {
        "id": "text_imdbId",
        "name": "imdbId",
        "type": "text",
        "required": false
      },
      {
        "id": "text_title",
        "name": "title",
        "type": "text",
        "required": true,
        "max": 255
      },
      {
        "id": "number_year",
        "name": "year",
        "type": "number",
        "required": false
      },
      {
        "id": "text_slug",
        "name": "slug",
        "type": "text",
        "required": false
      },
      {
        "id": "json_metadata",
        "name": "metadata",
        "type": "json",
        "required": false
      },
      {
        "id": "text_personalNote",
        "name": "personalNote",
        "type": "text",
        "required": false,
        "max": 500
      },
      {
        "id": "select_status",
        "name": "status",
        "type": "select",
        "required": false,
        "options": {
          "maxSelect": 1,
          "values": ["plan_to_watch", "watching", "completed", "dropped", "on_hold"]
        }
      },
      {
        "id": "number_rating",
        "name": "rating",
        "type": "number",
        "required": false,
        "min": 1,
        "max": 10
      },
      {
        "id": "number_order",
        "name": "order",
        "type": "number",
        "required": false
      },
      {
        "id": "autodate_created",
        "name": "created",
        "type": "autodate",
        "onCreate": true,
        "onUpdate": false
      },
      {
        "id": "autodate_updated",
        "name": "updated",
        "type": "autodate",
        "onCreate": true,
        "onUpdate": true
      }
    ],
    "indexes": [
      "CREATE INDEX idx_watchlist_items_watchlist ON watchlistItems (watchlist)",
      "CREATE INDEX idx_watchlist_items_trakt_id ON watchlistItems (traktId)",
      "CREATE INDEX idx_watchlist_items_tmdb_id ON watchlistItems (tmdbId)",
      "CREATE INDEX idx_watchlist_items_type ON watchlistItems (mediaType)",
      "CREATE INDEX idx_watchlist_items_status ON watchlistItems (status)",
      "CREATE UNIQUE INDEX idx_watchlist_items_unique ON watchlistItems (watchlist, traktId, mediaType)"
    ]
  },
  {
    "id": "user_follows_collection",
    "name": "userFollows",
    "type": "base",
    "listRule": "@request.auth.id != '' && (follower = @request.auth.id || following = @request.auth.id)",
    "viewRule": "@request.auth.id != '' && (follower = @request.auth.id || following = @request.auth.id)",
    "createRule": "@request.auth.id != '' && @request.body.follower = @request.auth.id && @request.body.following != @request.auth.id",
    "updateRule": null,
    "deleteRule": "@request.auth.id != '' && follower = @request.auth.id",
    "fields": [
      {
        "id": "text_id",
        "name": "id",
        "type": "text",
        "required": true,
        "primaryKey": true,
        "autogeneratePattern": "[a-z0-9]{15}"
      },
      {
        "id": "relation_follower",
        "name": "follower",
        "type": "relation",
        "required": true,
        "options": {
          "collectionId": "_pb_users_auth_",
          "cascadeDelete": true,
          "minSelect": 1,
          "maxSelect": 1,
          "displayFields": ["name", "email"]
        }
      },
      {
        "id": "relation_following",
        "name": "following",
        "type": "relation",
        "required": true,
        "options": {
          "collectionId": "_pb_users_auth_",
          "cascadeDelete": true,
          "minSelect": 1,
          "maxSelect": 1,
          "displayFields": ["name", "email"]
        }
      },
      {
        "id": "autodate_created",
        "name": "created",
        "type": "autodate",
        "onCreate": true,
        "onUpdate": false
      }
    ],
    "indexes": [
      "CREATE INDEX idx_user_follows_follower ON userFollows (follower)",
      "CREATE INDEX idx_user_follows_following ON userFollows (following)",
      "CREATE UNIQUE INDEX idx_user_follows_unique ON userFollows (follower, following)"
    ]
  },
  {
    "id": "watchlist_likes_collection",
    "name": "watchlistLikes",
    "type": "base",
    "listRule": "@request.auth.id != '' && (user = @request.auth.id || @collection.watchlists.owner ?= @request.auth.id)",
    "viewRule": "@request.auth.id != '' && (user = @request.auth.id || @collection.watchlists.owner ?= @request.auth.id)",
    "createRule": "@request.auth.id != '' && @request.body.user = @request.auth.id && @collection.watchlists.owner ?!= @request.auth.id",
    "updateRule": null,
    "deleteRule": "@request.auth.id != '' && user = @request.auth.id",
    "fields": [
      {
        "id": "text_id",
        "name": "id",
        "type": "text",
        "required": true,
        "primaryKey": true,
        "autogeneratePattern": "[a-z0-9]{15}"
      },
      {
        "id": "relation_user",
        "name": "user",
        "type": "relation",
        "required": true,
        "options": {
          "collectionId": "_pb_users_auth_",
          "cascadeDelete": true,
          "minSelect": 1,
          "maxSelect": 1,
          "displayFields": ["name", "email"]
        }
      },
      {
        "id": "relation_watchlist",
        "name": "watchlist",
        "type": "relation",
        "required": true,
        "options": {
          "collectionId": "watchlists_collection",
          "cascadeDelete": true,
          "minSelect": 1,
          "maxSelect": 1,
          "displayFields": ["title"]
        }
      },
      {
        "id": "autodate_created",
        "name": "created",
        "type": "autodate",
        "onCreate": true,
        "onUpdate": false
      }
    ],
    "indexes": [
      "CREATE INDEX idx_watchlist_likes_user ON watchlistLikes (user)",
      "CREATE INDEX idx_watchlist_likes_watchlist ON watchlistLikes (watchlist)",
      "CREATE UNIQUE INDEX idx_watchlist_likes_unique ON watchlistLikes (user, watchlist)"
    ]
  },
  {
    "id": "watchlist_shares_collection",
    "name": "watchlistShares",
    "type": "base",
    "listRule": "@request.auth.id != '' && (user = @request.auth.id || @collection.watchlists.owner ?= @request.auth.id)",
    "viewRule": "@request.auth.id != '' && (user = @request.auth.id || @collection.watchlists.owner ?= @request.auth.id)",
    "createRule": "@request.auth.id != '' && @collection.watchlists.owner ?= @request.auth.id",
    "updateRule": "@request.auth.id != '' && @collection.watchlists.owner ?= @request.auth.id",
    "deleteRule": "@request.auth.id != '' && (@collection.watchlists.owner ?= @request.auth.id || user = @request.auth.id)",
    "fields": [
      {
        "id": "text_id",
        "name": "id",
        "type": "text",
        "required": true,
        "primaryKey": true,
        "autogeneratePattern": "[a-z0-9]{15}"
      },
      {
        "id": "relation_watchlist",
        "name": "watchlist",
        "type": "relation",
        "required": true,
        "options": {
          "collectionId": "watchlists_collection",
          "cascadeDelete": true,
          "minSelect": 1,
          "maxSelect": 1,
          "displayFields": ["title"]
        }
      },
      {
        "id": "relation_user",
        "name": "user",
        "type": "relation",
        "required": true,
        "options": {
          "collectionId": "_pb_users_auth_",
          "cascadeDelete": true,
          "minSelect": 1,
          "maxSelect": 1,
          "displayFields": ["name", "email"]
        }
      },
      {
        "id": "select_permission",
        "name": "permission",
        "type": "select",
        "required": true,
        "options": {
          "maxSelect": 1,
          "values": ["view", "edit"]
        }
      },
      {
        "id": "autodate_created",
        "name": "created",
        "type": "autodate",
        "onCreate": true,
        "onUpdate": false
      }
    ],
    "indexes": [
      "CREATE INDEX idx_watchlist_shares_watchlist ON watchlistShares (watchlist)",
      "CREATE INDEX idx_watchlist_shares_user ON watchlistShares (user)",
      "CREATE UNIQUE INDEX idx_watchlist_shares_unique ON watchlistShares (watchlist, user)"
    ]
  },
  {
    "id": "watchlist_comments_collection",
    "name": "watchlistComments",
    "type": "base",
    "listRule": "@request.auth.id != '' && (@collection.watchlists.isPublic = true || @collection.watchlists.owner ?= @request.auth.id || @collection.watchlistShares.user ?= @request.auth.id)",
    "viewRule": "@request.auth.id != '' && (@collection.watchlists.isPublic = true || @collection.watchlists.owner ?= @request.auth.id || @collection.watchlistShares.user ?= @request.auth.id)",
    "createRule": "@request.auth.id != '' && @request.body.author = @request.auth.id && (@collection.watchlists.isPublic = true || @collection.watchlists.owner ?= @request.auth.id || @collection.watchlistShares.user ?= @request.auth.id)",
    "updateRule": "@request.auth.id != '' && author = @request.auth.id",
    "deleteRule": "@request.auth.id != '' && (author = @request.auth.id || @collection.watchlists.owner ?= @request.auth.id)",
    "fields": [
      {
        "id": "text_id",
        "name": "id",
        "type": "text",
        "required": true,
        "primaryKey": true,
        "autogeneratePattern": "[a-z0-9]{15}"
      },
      {
        "id": "relation_watchlist",
        "name": "watchlist",
        "type": "relation",
        "required": true,
        "options": {
          "collectionId": "watchlists_collection",
          "cascadeDelete": true,
          "minSelect": 1,
          "maxSelect": 1,
          "displayFields": ["title"]
        }
      },
      {
        "id": "relation_author",
        "name": "author",
        "type": "relation",
        "required": true,
        "options": {
          "collectionId": "_pb_users_auth_",
          "cascadeDelete": true,
          "minSelect": 1,
          "maxSelect": 1,
          "displayFields": ["name", "email"]
        }
      },
      {
        "id": "text_content",
        "name": "content",
        "type": "text",
        "required": true,
        "max": 1000,
        "min": 1
      },
      {
        "id": "relation_parentComment",
        "name": "parentComment",
        "type": "relation",
        "required": false,
        "options": {
          "collectionId": "watchlist_comments_collection",
          "cascadeDelete": true,
          "minSelect": 0,
          "maxSelect": 1,
          "displayFields": ["content"]
        }
      },
      {
        "id": "autodate_created",
        "name": "created",
        "type": "autodate",
        "onCreate": true,
        "onUpdate": false
      },
      {
        "id": "autodate_updated",
        "name": "updated",
        "type": "autodate",
        "onCreate": true,
        "onUpdate": true
      }
    ],
    "indexes": [
      "CREATE INDEX idx_watchlist_comments_watchlist ON watchlistComments (watchlist)",
      "CREATE INDEX idx_watchlist_comments_author ON watchlistComments (author)",
      "CREATE INDEX idx_watchlist_comments_parent ON watchlistComments (parentComment)",
      "CREATE INDEX idx_watchlist_comments_created ON watchlistComments (created)"
    ]
  }
]
